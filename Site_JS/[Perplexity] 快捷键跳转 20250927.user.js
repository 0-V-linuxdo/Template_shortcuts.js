// ==UserScript==
// @name         [Perplexity] å¿«æ·é”®è·³è½¬ 20250927
// @namespace    0_V userscripts/[Perplexity] shortcut
// @version      3.0.0
// @description  ä¸º Perplexity.ai æ·»åŠ è‡ªå®šä¹‰å¿«æ·é”®(è·³è½¬/ç‚¹å‡»/æ¨¡æ‹ŸæŒ‰é”®), æ”¯æŒè‡ªå®šä¹‰ å›¾æ ‡/å¿«æ·é”®/é€‰æ‹©å™¨/æ¨¡æ‹ŸæŒ‰é”®, é€‚é…æš—é»‘æ¨¡å¼ã€‚æ–°å¢: é¢„è®¾å›¾æ ‡åº“(å¯æŠ˜å /è‡ªå®šä¹‰æ·»åŠ /é•¿æŒ‰åˆ é™¤)ã€å›¾æ ‡ç¼“å­˜ã€ç”¨æˆ·ä½“éªŒä¼˜åŒ–ç­‰åŠŸèƒ½ã€‚ï¼ˆåŸºäº Template æ¨¡å—é‡æ„ï¼‰
// @match        https://www.perplexity.ai/*
// @grant        GM_registerMenuCommand
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_xmlhttpRequest
// @connect      *
// @require      https://github.com/0-V-linuxdo/-/raw/e17b029d255053ccec15e648156adbcec93924e5/%5BTemplate%5D%20%E5%BF%AB%E6%8D%B7%E9%94%AE%E8%B7%B3%E8%BD%AC%2020250924.js
// @icon         https://github.com/0-V-linuxdo/Template_shortcuts.js/raw/refs/heads/main/Site_Icon/Perplexity_keycap.svg
// ==/UserScript==

(function () {
    'use strict';

    // æ£€æŸ¥æ¨¡ç‰ˆä¾èµ–
    if (!window.ShortcutTemplate || typeof window.ShortcutTemplate.createShortcutEngine !== 'function') {
        console.error('[Perplexity Shortcut] Template module not found.');
        return;
    }

    // Perplexity ç‰¹å®šé…ç½®
    const defaultIconURL = "https://www.perplexity.ai/favicon.ico";

    // é»˜è®¤å›¾æ ‡åº“
    const defaultIcons = [
        { name: "Perplexity", url: "https://www.perplexity.ai/favicon.ico" },
        { name: "Google", url: "https://www.google.com/favicon.ico" },
        { name: "Bing", url: "https://www.bing.com/favicon.ico" },
        { name: "DuckDuckGo", url: "https://duckduckgo.com/favicon.ico" },
        { name: "Baidu", url: "https://www.baidu.com/favicon.ico" },
        { name: "Wikipedia", url: "https://www.wikipedia.org/static/favicon/wikipedia.ico" },
        { name: "Reddit", url: "https://www.reddit.com/favicon.ico" },
        { name: "Stack Overflow", url: "https://cdn.sstatic.net/Sites/stackoverflow/Img/favicon.ico" },
        { name: "GitHub", url: "https://github.githubassets.com/favicons/favicon.svg" },
        { name: "Twitter / X", url: "https://abs.twimg.com/favicons/twitter.3.ico" },
        { name: "ChatGPT", url: "https://chat.openai.com/favicon.ico" },
        { name: "Claude", url: "https://claude.ai/favicon.ico" },
        { name: "YouTube", url: "https://www.youtube.com/favicon.ico" },
        { name: "Bilibili", url: "https://www.bilibili.com/favicon.ico" },
    ];

    // æ ¸å¿ƒPerplexityå›¾æ ‡ï¼ˆä¸ä¼šè¢«æŠ˜å éšè—ï¼‰
    const protectedIconUrls = [
        "https://www.perplexity.ai/favicon.ico"
    ];

    // é»˜è®¤å¿«æ·é”®é…ç½®ï¼ˆä¸ºPerplexity.aiä¼˜åŒ–ï¼‰
    const defaultShortcuts = [
        // --- PerplexityåŸç”Ÿå¿«æ·é”®æ¨¡æ‹Ÿ ---
        {
            name: "New Thread",
            actionType: "simulate",
            url: "",
            urlMethod: "current",
            urlAdvanced: "href",
            selector: "",
            simulateKeys: "META+K",
            hotkey: "CTRL+N",
            icon: "data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2220%22%20height%3D%2220%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20stroke%3D%22currentColor%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%20class%3D%22tabler-icon%20tabler-icon-plus%20tabler-icon%22%3E%3Cpath%20d%3D%22M12%205l0%2014%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M5%2012l14%200%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E"
        },
        {
            name: "Toggle Incognito",
            actionType: "simulate",
            url: "",
            urlMethod: "current",
            urlAdvanced: "href",
            selector: "",
            simulateKeys: "META+;",
            hotkey: "CTRL+I",
            icon: "data:image/svg+xml,%3Csvg%20width%3D%2216%22%20height%3D%22auto%22%20viewBox%3D%220%200%2024%2024%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%3Cpath%20fill-rule%3D%22evenodd%22%20clip-rule%3D%22evenodd%22%20d%3D%22M11.1927%204.54688C11.4375%204.71875%2011.651%204.86458%2012%204.86458C12.3453%204.86458%2012.5529%204.72184%2012.7993%204.55235L12.8073%204.54688L12.8084%204.54609C13.152%204.31187%2013.5635%204.03125%2014.5%204.03125C16.0885%204.03125%2017.2083%206.30729%2017.9375%208.6875C20.401%209.14062%2022%209.875%2022%2010.6979C22%2011.4427%2020.6979%2012.1094%2018.6354%2012.5677C18.6562%2012.776%2018.6667%2012.9844%2018.6667%2013.1979C18.6667%2014.0833%2018.4948%2014.9271%2018.1823%2015.6979H18.1965C17.2165%2018.1697%2014.8115%2019.9169%2012%2019.9169C9.18854%2019.9169%206.78355%2018.1697%205.80356%2015.6979H5.81771C5.50521%2014.9271%205.33333%2014.0833%205.33333%2013.1979C5.33333%2012.9844%205.34375%2012.776%205.36458%2012.5677C3.30208%2012.1094%202%2011.4427%202%2010.6979C2%209.875%203.59896%209.14062%206.0625%208.6875C6.79167%206.30729%207.91146%204.03125%209.5%204.03125C10.4365%204.03125%2010.848%204.31187%2011.1916%204.54609L11.1927%204.54688ZM14.2708%2015.6979H14.9167C16.0677%2015.6979%2017%2014.7656%2017%2013.6146V12.8646C15.5312%2013.0781%2013.8229%2013.1979%2012%2013.1979C10.1771%2013.1979%208.46875%2013.0781%207%2012.8646V13.6146C7%2014.7656%207.93229%2015.6979%209.08333%2015.6979H9.73437C10.5885%2015.6979%2011.3542%2015.1458%2011.625%2014.3333C11.7448%2013.9687%2012.2604%2013.9687%2012.3802%2014.3333C12.651%2015.1458%2013.4115%2015.6979%2014.2708%2015.6979Z%22%20fill%3D%22currentColor%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E"
        },
        {
            name: "Focus Ask Input",
            actionType: "simulate",
            url: "",
            urlMethod: "current",
            urlAdvanced: "href",
            selector: "",
            simulateKeys: "META+J",
            hotkey: "CTRL+/",
            icon: "data:image/svg+xml,%3Csvg%20width%3D%22100%22%20height%3D%22100%22%20viewBox%3D%220%200%20400%20400%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%20%20%20%20%3Cpath%20fill-rule%3D%22evenodd%22%20clip-rule%3D%22evenodd%22%20d%3D%22M101.008%2042L190.99%20124.905V124.886V42.1913H208.506V125.276L298.891%2042V136.524H336V272.866H299.005V357.035L208.506%20277.525V357.948H190.99V278.836L101.11%20358V272.866H64V136.524H101.008V42ZM177.785%20153.826H81.5159V255.564H101.088V223.472L177.785%20153.826ZM118.625%20231.149V319.392L190.99%20255.655V165.421L118.625%20231.149ZM209.01%20254.812V165.336L281.396%20231.068V272.866H281.489V318.491L209.01%20254.812ZM299.005%20255.564H318.484V153.826H222.932L299.005%20222.751V255.564ZM281.375%20136.524V81.7983L221.977%20136.524H281.375ZM177.921%20136.524H118.524V81.7983L177.921%20136.524Z%22%20fill%3D%22black%22%2F%3E%0A%3C%2Fsvg%3E%0A%20%20%20%20"
        },
        // --- URLå¯¼èˆª ---
        {
            name: "Go to Home",
            actionType: "url",
            url: "https://www.perplexity.ai",
            urlMethod: "current",
            urlAdvanced: "href",
            selector: "",
            simulateKeys: "",
            hotkey: "CTRL+H",
            icon: "data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20color%3D%22currentColor%22%20class%3D%22tabler-icon%20duration-100%20group-hover%3Ascale-110%20text-foreground%20scale-110%22%20fill%3D%22currentColor%22%20fill-rule%3D%22evenodd%22%3E%3Cpath%20d%3D%22M18.8809%2018.8809C19.2013%2018.5604%2019.7091%2018.5407%2020.0527%2018.8213L20.1191%2018.8809L22.3086%2021.0713L22.3691%2021.1377C22.6493%2021.4814%2022.6289%2021.9883%2022.3086%2022.3086C21.9883%2022.6288%2021.4813%2022.6493%2021.1377%2022.3691L21.0713%2022.3086L18.8809%2020.1191L18.8213%2020.0527C18.5407%2019.7091%2018.5605%2019.2013%2018.8809%2018.8809ZM10.75%202.00488C15.5724%202.00494%2019.5048%205.92589%2019.5049%2010.7598C19.5049%2015.593%2015.5832%2019.5146%2010.75%2019.5146H9.875V19.4502C5.46095%2019.01%201.9953%2015.278%201.99512%2010.7402C1.99512%205.90341%205.93043%202.00495%2010.75%202.00488ZM10.75%203.75488C6.88968%203.75495%203.74512%206.87714%203.74512%2010.7402C3.74531%2014.6061%206.8927%2017.7451%2010.75%2017.7451H11.25C14.8836%2017.4884%2017.7549%2014.4584%2017.7549%2010.7598C17.7548%206.89383%2014.6074%203.75494%2010.75%203.75488ZM10.75%209C11.7165%209%2012.5%209.7835%2012.5%2010.75C12.4999%2011.7164%2011.7165%2012.5%2010.75%2012.5C9.78354%2012.5%209.00006%2011.7164%209%2010.75C9%209.7835%209.7835%209%2010.75%209Z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E"
        },
        {
            name: "Go to Library",
            actionType: "url",
            url: "https://www.perplexity.ai/library",
            urlMethod: "current",
            urlAdvanced: "href",
            selector: "",
            simulateKeys: "",
            hotkey: "CTRL+L",
            icon: "data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20color%3D%22currentColor%22%20class%3D%22tabler-icon%22%20fill%3D%22currentColor%22%20fill-rule%3D%22evenodd%22%3E%3Cpath%20d%3D%22M9%2015.9951C10.4319%2015.9952%2011.7044%2016.6861%2012.5029%2017.752C13.3018%2016.6913%2014.5722%2016.0049%2016%2016.0049H22.1299L22.2197%2016.0098C22.6608%2016.0547%2023.0049%2016.4269%2023.0049%2016.8799C23.0049%2017.3328%2022.6608%2017.7051%2022.2197%2017.75L22.1299%2017.7549H16C14.5532%2017.7549%2013.375%2018.9331%2013.375%2020.3799V21.25C13.3749%2021.7331%2012.9831%2022.1249%2012.5%2022.125C12.0169%2022.1249%2011.6251%2021.7331%2011.625%2021.25V20.3701C11.625%2018.9234%2010.4467%2017.7452%209%2017.7451H2.87988C2.39676%2017.7451%202.00501%2017.3532%202.00488%2016.8701C2.00488%2016.3869%202.39669%2015.9952%202.87988%2015.9951H9ZM12.5%202.00488C18.3038%202.00495%2022.9951%206.70738%2022.9951%2012.5V13.3799C22.9951%2013.8631%2022.6033%2014.2548%2022.1201%2014.2549C21.6369%2014.2548%2021.2451%2013.8631%2021.2451%2013.3799V12.5C21.2451%207.6727%2017.3361%203.75495%2012.5%203.75488C7.6633%203.75494%203.75488%207.66329%203.75488%2012.5V13.3799C3.75488%2013.8631%203.36313%2014.2549%202.87988%2014.2549C2.39669%2014.2548%202.00488%2013.8631%202.00488%2013.3799V12.5C2.00488%206.69679%206.6968%202.00494%2012.5%202.00488ZM12.5%206.375C15.8832%206.375%2018.625%209.11675%2018.625%2012.5V13.3799C18.6249%2013.8631%2018.2332%2014.2549%2017.75%2014.2549C17.2668%2014.2549%2016.8751%2013.8631%2016.875%2013.3799V12.5C16.875%2010.0833%2014.9167%208.125%2012.5%208.125C10.0832%208.125%208.125%2010.0832%208.125%2012.5V13.3799C8.12494%2013.8631%207.73321%2014.2549%207.25%2014.2549C6.76679%2014.2549%206.37506%2013.8631%206.375%2013.3799V12.5C6.375%209.11675%209.11675%206.375%2012.5%206.375ZM12.5%2010.75C13.4665%2010.75%2014.25%2011.5335%2014.25%2012.5C14.2499%2013.4664%2013.4665%2014.25%2012.5%2014.25C11.5335%2014.25%2010.7501%2013.4664%2010.75%2012.5C10.75%2011.5335%2011.5335%2010.75%2012.5%2010.75Z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E"
        },
        {
            name: "Go to Discover",
            actionType: "url",
            url: "https://www.perplexity.ai/discover",
            urlMethod: "current",
            urlAdvanced: "href",
            selector: "",
            simulateKeys: "",
            hotkey: "CTRL+D",
            icon: "data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20color%3D%22currentColor%22%20class%3D%22tabler-icon%20duration-100%20group-hover%3Ascale-110%20text-quiet%22%20fill%3D%22currentColor%22%20fill-rule%3D%22evenodd%22%3E%3Cpath%20d%3D%22M12.3799%200.995117C18.6621%200.995117%2023.7549%206.08788%2023.7549%2012.3701C23.7549%2018.6524%2018.6621%2023.7451%2012.3799%2023.7451C6.0977%2023.7451%201.00488%2018.6523%201.00488%2012.3701C1.00488%206.08792%206.0977%200.995179%2012.3799%200.995117ZM12.3701%202.75488C11.8475%202.75509%2011.1171%203.22655%2010.4121%204.58887L10.2715%204.87402C10.065%205.3106%209.54321%205.49714%209.10645%205.29102C8.66967%205.08453%208.48308%204.56284%208.68945%204.12598L8.84277%203.81445C8.93133%203.64256%209.02498%203.47428%209.12305%203.31055C7.13221%204.02636%205.44689%205.38035%204.31055%207.125H12.3809L12.4697%207.12988C12.9108%207.17482%2013.2558%207.54711%2013.2559%208C13.2559%208.45294%2012.9108%208.82517%2012.4697%208.87012L12.3809%208.875H3.41211C2.98945%209.95869%202.75488%2011.1368%202.75488%2012.3701C2.75488%2013.6071%202.99092%2014.7886%203.41602%2015.875H4.94043C5.42344%2015.8752%205.81537%2016.2669%205.81543%2016.75C5.81543%2017.2331%205.42348%2017.6248%204.94043%2017.625H4.31738C5.45343%2019.3645%207.13555%2020.7142%209.12207%2021.4287C8.88505%2021.0314%208.66832%2020.5962%208.47461%2020.1318C7.62775%2018.1014%207.12501%2015.3566%207.125%2012.3701C7.125%2012.083%207.12514%2011.7675%207.13574%2011.46C7.15246%2010.9771%207.55716%2010.5996%208.04004%2010.6162C8.523%2010.6329%208.90142%2011.0375%208.88477%2011.5205C8.87538%2011.7927%208.875%2012.0775%208.875%2012.3701C8.87501%2015.1832%209.3519%2017.6886%2010.0898%2019.458C10.4596%2020.3446%2010.8783%2021.0053%2011.2979%2021.4307C11.7142%2021.8527%2012.0793%2021.995%2012.3799%2021.9951C12.9373%2021.9951%2013.731%2021.4591%2014.4785%2019.877L14.5215%2019.7979C14.7504%2019.418%2015.2339%2019.2656%2015.6436%2019.459C16.0804%2019.6654%2016.2679%2020.1871%2016.0615%2020.624L15.9072%2020.9355C15.8202%2021.1046%2015.7271%2021.2695%2015.6309%2021.4307C17.6203%2020.7168%2019.305%2019.3664%2020.4424%2017.625H12.3799C11.8967%2017.6249%2011.5049%2017.2332%2011.5049%2016.75C11.5049%2016.2668%2011.8967%2015.8751%2012.3799%2015.875H21.3438C21.7689%2014.7886%2022.0049%2013.6072%2022.0049%2012.3701C22.0049%2011.1368%2021.7703%209.95871%2021.3477%208.875H19.8096C19.3265%208.87477%2018.9346%208.48311%2018.9346%208C18.9346%207.51695%2019.3266%207.12523%2019.8096%207.125H20.4492C19.309%205.3744%2017.6159%204.01757%2015.6162%203.30371C15.8576%203.70575%2016.0787%204.14659%2016.2754%204.61816C17.1223%206.64864%2017.625%209.39331%2017.625%2012.3799C17.625%2012.667%2017.6258%2012.9825%2017.6152%2013.29L17.6074%2013.3789C17.5476%2013.8184%2017.1627%2014.1501%2016.71%2014.1348C16.2272%2014.1179%2015.8496%2013.7123%2015.8662%2013.2295L15.875%2012.3799C15.875%209.56674%2015.3982%207.0614%2014.6602%205.29199C14.2904%204.40554%2013.8727%203.7447%2013.4531%203.31934C13.0368%202.89735%2012.6707%202.75503%2012.3701%202.75488ZM12.3799%2010.6201C13.3464%2010.6201%2014.1299%2011.4036%2014.1299%2012.3701C14.1299%2013.3366%2013.3464%2014.1201%2012.3799%2014.1201C11.4134%2014.1201%2010.6299%2013.3366%2010.6299%2012.3701C10.6299%2011.4037%2011.4134%2010.6202%2012.3799%2010.6201Z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E"
        },
        {
            name: "Go to Spaces",
            actionType: "url",
            url: "https://www.perplexity.ai/spaces",
            urlMethod: "current",
            urlAdvanced: "href",
            selector: "",
            simulateKeys: "",
            hotkey: "CTRL+S",
            icon: "data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%20color%3D%22currentColor%22%20class%3D%22tabler-icon%20duration-100%20group-hover%3Ascale-110%20text-quiet%22%20fill%3D%22currentColor%22%20fill-rule%3D%22evenodd%22%3E%3Cpath%20d%3D%22M22.1475%202.00586C22.1569%202.00616%2022.1663%202.00721%2022.1758%202.00781L22.209%202.00977C22.2435%202.01325%2022.2773%202.01899%2022.3105%202.02637C22.3158%202.02753%2022.3209%202.02901%2022.3262%202.03027C22.3568%202.03766%2022.3858%202.04906%2022.415%202.05957C22.5326%202.10177%2022.6441%202.16668%2022.7383%202.26074C22.7468%202.26924%2022.7546%202.27835%2022.7627%202.28711C22.7657%202.29033%2022.7686%202.29361%2022.7715%202.29688C22.8041%202.33334%2022.8329%202.37193%2022.8584%202.41211C22.8612%202.41654%2022.8635%202.4213%2022.8662%202.42578C22.8909%202.46628%2022.9132%202.50759%2022.9307%202.55078C22.972%202.65239%2022.9951%202.76339%2022.9951%202.87988V17.75C22.9951%2018.2332%2022.6033%2018.6249%2022.1201%2018.625H7.6123L4.99219%2021.2451H16.875C16.8776%2020.7642%2017.2684%2020.3751%2017.75%2020.375C18.2332%2020.3751%2018.625%2020.7668%2018.625%2021.25V22.1201C18.6249%2022.6033%2018.2332%2022.9951%2017.75%2022.9951H2.87988C2.39673%2022.9951%202.00495%2022.6033%202.00488%2022.1201V7.25L2.00977%207.16016C2.05476%206.71917%202.42703%206.37506%202.87988%206.375H17.3867L20.0068%203.75488H8.125C8.12231%204.23583%207.73158%204.625%207.25%204.625C6.76679%204.625%206.37506%204.2332%206.375%203.75V2.87988L6.37988%202.79004C6.42488%202.34901%206.7971%202.00488%207.25%202.00488H22.1201L22.1475%202.00586ZM18.625%207.6123V14.25C18.625%2014.7332%2018.2332%2015.1249%2017.75%2015.125C17.2668%2015.1249%2016.875%2014.7332%2016.875%2014.25V8.125H3.75488V20.0068L6.375%2017.3867V10.75C6.375%2010.2668%206.76675%209.875%207.25%209.875C7.73325%209.875%208.125%2010.2668%208.125%2010.75V16.875H21.2451V4.99219L18.625%207.6123ZM12.5%2010.75C13.4665%2010.75%2014.25%2011.5335%2014.25%2012.5C14.25%2013.4665%2013.4665%2014.25%2012.5%2014.25C11.5335%2014.25%2010.75%2013.4665%2010.75%2012.5C10.75%2011.5335%2011.5335%2010.75%2012.5%2010.75Z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E"
        }
    ];

    // åˆ›å»ºå¿«æ·é”®å¼•æ“å®ä¾‹
    const engine = window.ShortcutTemplate.createShortcutEngine({
        menuCommandLabel: "Perplexity - è®¾ç½®å¿«æ·é”®",
        panelTitle: "Perplexity - è‡ªå®šä¹‰å¿«æ·é”®",
        storageKeys: {
            shortcuts: "perplexity_shortcuts_v2",
            iconCachePrefix: "perplexity_icon_cache_v1::",
            userIcons: "perplexity_user_icons_v1"
        },
        ui: {
            idPrefix: "perplexity",
            cssPrefix: "perplexity",
            compactBreakpoint: 800
        },
        defaultIconURL,
        iconLibrary: defaultIcons,
        protectedIconUrls,
        defaultShortcuts,
        consoleTag: "[Perplexity Shortcut Script]",
        colors: {
            primary: "#20b2aa" // Perplexityå¯å‘çš„ä¸»è‰²è°ƒ
        },
        // Perplexityç‰¹å®šçš„å›¾æ ‡ç¼“å­˜é€»è¾‘
        shouldBypassIconCache: (url) => {
            return url && url.startsWith('https://www.perplexity.ai/');
        },
        // è·å–å½“å‰æœç´¢è¯ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰
        getCurrentSearchTerm: () => {
            // å°è¯•ä»URLå‚æ•°è·å–
            try {
                const urlParams = new URL(location.href).searchParams;
                return urlParams.get('q');
            } catch {
                return null;
            }
        },
        // URLæ¨¡ç‰ˆè§£æï¼ˆæ”¯æŒ%så ä½ç¬¦ï¼‰
        resolveUrlTemplate: (targetUrl, { getCurrentSearchTerm, placeholderToken }) => {
            const placeholder = placeholderToken || '%s';
            if (!targetUrl.includes(placeholder)) return targetUrl;

            let currentKeyword = null;
            try {
                currentKeyword = typeof getCurrentSearchTerm === 'function'
                    ? getCurrentSearchTerm()
                    : null;
            } catch (err) {
                console.warn("[Perplexity Shortcut Script] resolveUrlTemplate error", err);
            }

            if (currentKeyword !== null && currentKeyword !== undefined) {
                return targetUrl.replaceAll(placeholder, encodeURIComponent(currentKeyword));
            }

            // å¦‚æœæ²¡æœ‰æœç´¢è¯ï¼Œç§»é™¤æŸ¥è¯¢å‚æ•°
            if (placeholder === '%s' && targetUrl.includes('?')) {
                return targetUrl.substring(0, targetUrl.indexOf('?'));
            }

            return targetUrl.replaceAll(placeholder, '');
        },
        // ç•Œé¢æ–‡æœ¬é…ç½®
        text: {
            stats: {
                total: "æ€»è®¡",
                url: "URLè·³è½¬",
                selector: "å…ƒç´ ç‚¹å‡»",
                simulate: "æŒ‰é”®æ¨¡æ‹Ÿ"
            },
            buttons: {
                addShortcut: "æ·»åŠ æ–°å¿«æ·é”®",
                saveAndClose: "ä¿å­˜å¹¶å…³é—­",
                confirm: "ç¡®å®š",
                cancel: "å–æ¶ˆ",
                delete: "åˆ é™¤",
                edit: "ç¼–è¾‘",
                clear: "æ¸…é™¤"
            },
            dialogs: {
                alert: "æç¤º",
                confirm: "ç¡®è®¤",
                prompt: "è¾“å…¥"
            },
            hints: {
                hotkey: "ç‚¹å‡»æ­¤å¤„ï¼Œç„¶åæŒ‰ä¸‹å¿«æ·é”®ç»„åˆ",
                simulate: "ç‚¹å‡»æ­¤å¤„ï¼Œç„¶åæŒ‰ä¸‹è¦æ¨¡æ‹Ÿçš„æŒ‰é”®ç»„åˆ",
                hotkeyHelp: "ğŸ’¡ æ”¯æŒ Ctrl/Shift/Alt/Cmd + å­—æ¯/æ•°å­—/åŠŸèƒ½é”®ç­‰ç»„åˆ",
                simulateHelp: "âš¡ å°†æ¨¡æ‹Ÿè¿™ä¸ªæŒ‰é”®ç»„åˆå‘é€åˆ°ç½‘é¡µ"
            },
            menuLabelFallback: "Perplexity - è®¾ç½®å¿«æ·é”®"
        }
    });

    // åˆå§‹åŒ–å¼•æ“
    engine.init();

})();
